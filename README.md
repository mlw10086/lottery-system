# 🎲 智能城市抽奖系统

一个功能完整的三轮城市抽奖系统，支持管理员操作和观众实时观看，具备动态权重算法、周边城市推荐等高级功能。

![系统预览](https://img.shields.io/badge/状态-完成-brightgreen) ![技术栈](https://img.shields.io/badge/技术栈-HTML5%2BCSS3%2BJS%2BPHP-blue) ![响应式](https://img.shields.io/badge/响应式-支持-orange)

## 📋 项目概述

### 🎯 核心功能
- **三轮抽奖机制**：10→5→2→1 的递进式抽奖流程
- **双端同步**：管理员端操作，观众端实时同步观看
- **动态权重算法**：基于红包算法的智能权重分配
- **周边城市推荐**：获胜城市的高性价比旅游推荐
- **实时动画效果**：流畅的抽奖动画和视觉反馈

### 👥 用户角色
- **管理员**：完整的抽奖流程控制（密码：admin123）
- **观众**：实时观看抽奖过程，页面自动同步更新

### 🎨 界面特色
- **现代化设计**：渐变背景、毛玻璃效果、流畅动画
- **响应式布局**：完美适配PC端、平板端、手机端
- **实时状态指示**：清晰的状态显示和进度提示
- **中文优化**：专为中文用户设计的高质感界面

## 🏗️ 技术架构

### 前端技术
- **HTML5 + CSS3**：现代化界面设计，支持CSS Grid和Flexbox
- **原生JavaScript (ES6+)**：高性能交互逻辑，异步编程
- **实时同步**：基于轮询的状态同步机制
- **响应式设计**：支持PC端、平板端、手机端

### 后端技术
- **PHP 8.0+**：轻量级后端API服务
- **JSON文件存储**：无需数据库，高效数据持久化
- **RESTful API**：标准化接口设计
- **状态管理**：实时状态同步和数据一致性

### 核心算法
- **动态权重分池红包算法**：基于红包分配原理的公平抽奖
- **实时权重计算**：动态调整城市抽中概率
- **异步数据处理**：高效的数据加载和处理机制
- **错误处理机制**：完善的异常处理和优雅降级

## 📁 项目结构

```
lottery-system/
├── index.html              # 管理员端主页面
├── viewer.html             # 观众端页面
├── css/
│   └── style.css           # 完整样式文件（1000+行）
├── js/
│   ├── lottery.js          # 管理员端核心逻辑（1200+行）
│   └── viewer.js           # 观众端实时同步逻辑（500+行）
├── php/
│   └── lottery_api.php     # 统一API接口（400+行）
├── data/
│   ├── cities.json         # 10个城市基础数据
│   ├── lottery_state.json  # 实时抽奖状态数据
│   └── nearby_cities.json  # 50个周边城市推荐数据
└── README.md              # 完整项目文档
```

### 核心文件说明
- **index.html**：管理员端界面，包含完整的抽奖控制功能
- **viewer.html**：观众端界面，实时同步显示抽奖过程
- **lottery.js**：管理员端核心逻辑，包含三轮抽奖算法
- **viewer.js**：观众端同步逻辑，实时状态更新
- **lottery_api.php**：后端API，处理所有抽奖相关请求
- **nearby_cities.json**：包含10个主要城市的50个周边推荐

## 🚀 快速开始

### 环境要求
- **PHP版本**：8.0+ （推荐8.1+）
- **Web服务器**：Apache/Nginx/PHP内置服务器
- **浏览器**：Chrome 80+, Firefox 75+, Safari 13+, Edge 80+
- **设备**：支持桌面端、平板端、手机端

### 安装步骤

1. **下载项目**
   ```bash
   # 克隆或下载项目文件
   git clone [项目地址]
   cd lottery-system
   ```

2. **配置权限**
   ```bash
   # 设置数据文件写入权限
   chmod 666 data/*.json
   chmod 755 php/
   ```

3. **启动服务器**
   ```bash
   # 开发环境 - 使用PHP内置服务器
   php -S localhost:8000

   # 生产环境 - 配置Apache/Nginx
   # 将项目目录设为Web根目录
   ```

4. **访问系统**
   ```
   管理员端：http://localhost:8000/index.html
   观众端：  http://localhost:8000/viewer.html
   ```

### 使用说明

#### 🔑 管理员操作流程
1. **登录系统**
   - 访问管理员端：`http://localhost:8000/index.html`
   - 点击"管理员登录"按钮
   - 输入密码：`admin123`

2. **三轮抽奖流程**
   - **第一轮**：点击"开始第一轮抽奖"，等待20秒（10→5）
   - **第二轮**：第一轮完成后，点击"开始第二轮抽奖"，等待30秒（5→2）
   - **第三轮**：第二轮完成后，点击"开始第三轮抽奖"，等待45秒（2→1）

3. **系统管理**
   - **重置抽奖**：清空所有数据，重新开始
   - **退出登录**：安全退出管理员模式

#### 👥 观众观看流程
1. **访问观众端**
   - 打开：`http://localhost:8000/viewer.html`
   - 无需登录，直接观看

2. **实时体验**
   - 自动同步当前抽奖状态
   - 观看完整的抽奖动画过程
   - 查看实时权重变化和倒计时
   - 获取最终结果和周边城市推荐

## 🎮 抽奖流程详解

### 🎯 第一轮抽奖（10→5，20秒）
1. **候选城市**：10个精选中国城市
2. **抽奖时长**：20秒动画过程
3. **算法机制**：动态权重分池红包算法
4. **视觉效果**：随机高亮城市卡片，实时权重变化
5. **结果展示**：5个入围城市详细信息

### 🎯 第二轮抽奖（5→2，30秒）
1. **候选城市**：第一轮入围的5个城市
2. **抽奖时长**：30秒决赛级动画
3. **算法升级**：更复杂的权重计算
4. **视觉升级**：更炫酷的动画效果
5. **结果展示**：2个决赛城市 + 第二轮最终结果

### 🏆 第三轮抽奖（2→1，45秒）
1. **候选城市**：第二轮决赛的2个城市
2. **抽奖时长**：45秒终极决赛
3. **算法巅峰**：最高级别的权重算法
4. **视觉巅峰**：最震撼的决赛动画
5. **终极结果**：1个最终获胜城市 + 周边城市推荐

### 🌟 周边推荐系统
1. **数据覆盖**：10个主要城市，50个周边推荐
2. **推荐内容**：距离、交通方式、特色介绍
3. **展示方式**：专业表格式布局
4. **实用价值**：高性价比旅游延伸建议

## 📊 数据说明

### 🏙️ 主要城市（10个）
| 城市 | 坐标 | 描述 | 特色 |
|------|------|------|------|
| 武汉 | 30.59°N, 114.31°E | 九省通衢，江城武汉 | 长江中游中心城市 |
| 上海 | 31.23°N, 121.47°E | 东方明珠，国际都市 | 国际金融中心 |
| 香港 | 22.32°N, 114.17°E | 东方之珠，购物天堂 | 国际贸易中心 |
| 西安 | 34.34°N, 108.94°E | 千年古都，丝路起点 | 历史文化名城 |
| 厦门 | 24.48°N, 118.10°E | 海上花园，鹭岛风情 | 海滨旅游城市 |
| 洛阳 | 34.62°N, 112.45°E | 千年帝都，牡丹花城 | 古都文化 |
| 贵阳 | 26.65°N, 106.63°E | 爽爽贵阳，避暑之都 | 生态旅游 |
| 黄山 | 29.71°N, 118.34°E | 天下第一奇山 | 自然风光 |
| 成都 | 30.57°N, 104.07°E | 天府之国，休闲之都 | 美食文化 |
| 哈尔滨 | 45.80°N, 126.53°E | 冰雪之都，东方莫斯科 | 冰雪旅游 |

### 🌟 周边推荐数据（50个）
每个主要城市配置5个周边高性价比旅游城市：

#### 数据格式示例
```json
{
  "name": "荆州",
  "distance": 220,
  "transport": "高铁、汽车",
  "description": "荆州是历史文化名城，有荆州古城墙、荆州博物馆等众多古迹，能让人感受深厚的历史底蕴。"
}
```

#### 推荐特色
- **实用距离**：50-220公里适中距离
- **交通便利**：高铁、汽车等多种交通方式
- **性价比高**：精选高性价比旅游目的地
- **特色鲜明**：每个城市都有独特的文化特色

## API接口

### 抽奖控制API
- `POST /php/lottery_api.php`
  - `start_phase1`：开始第一轮
  - `complete_phase1`：完成第一轮
  - `start_phase2`：开始第二轮
  - `complete_phase2`：完成第二轮
  - `reset`：重置抽奖

### 状态查询API
- `GET /php/state_api.php?action=get`：获取当前状态

### 距离计算API
- `POST /php/distance_api.php`
  - `calculate_distance`：计算城市距离
  - `get_recommendations`：获取推荐城市

## 自定义配置

### 修改城市数据
编辑 `data/cities.json` 文件，可以：
- 添加/删除城市
- 修改城市信息（坐标、描述）
- 调整初始权重

### 修改推荐数据
编辑 `data/nearby_cities.json` 文件，可以：
- 添加推荐城市
- 修改评分和亮点
- 调整推荐范围

### 修改抽奖参数
在 `js/lottery.js` 中可以调整：
- 抽奖持续时间
- 动画效果
- 权重算法参数

## 安全说明

- 管理员密码存储在前端代码中，仅适用于演示
- 生产环境建议使用更安全的认证机制
- 所有数据存储在本地JSON文件中，注意文件权限

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 许可证

本项目仅供学习和演示使用。
